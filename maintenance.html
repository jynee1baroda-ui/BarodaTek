<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>üéÆ BarodaTek Arena - System Update in Progress</title>
    <link rel="icon" type="image/png" href="barodatek-logo.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            color: #00ff41;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            position: relative;
        }

        /* Animated starfield background */
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: #fff;
            border-radius: 50%;
            animation: twinkle 3s ease-in-out infinite;
        }

        .container {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            text-align: center;
        }

        .logo {
            width: 200px;
            height: 200px;
            margin-bottom: 40px;
            filter: drop-shadow(0 0 20px #00ff41) drop-shadow(0 0 40px #ff6b00);
            animation: logoFloat 3s ease-in-out infinite;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        h1 {
            font-size: 4rem;
            margin-bottom: 20px;
            text-shadow: 
                0 0 10px #00ff41,
                0 0 20px #00ff41,
                0 0 30px #00ff41,
                0 0 40px #ff6b00;
            animation: glitch 5s ease-in-out infinite;
        }

        @keyframes glitch {
            0%, 90%, 100% { transform: translate(0); }
            91% { transform: translate(-2px, 2px); }
            92% { transform: translate(2px, -2px); }
            93% { transform: translate(-2px, -2px); }
            94% { transform: translate(2px, 2px); }
            95% { transform: translate(0); }
        }

        .subtitle {
            font-size: 1.5rem;
            color: #ff6b00;
            margin-bottom: 40px;
            text-shadow: 0 0 10px #ff6b00;
        }

        .progress-container {
            width: 80%;
            max-width: 600px;
            height: 40px;
            background: #111;
            border: 3px solid #00ff41;
            border-radius: 10px;
            margin-bottom: 30px;
            overflow: hidden;
            box-shadow: 
                0 0 20px rgba(0, 255, 65, 0.5),
                inset 0 0 20px rgba(0, 255, 65, 0.2);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00ff41, #ff6b00, #00ff41);
            background-size: 200% 100%;
            animation: progressGlow 2s linear infinite;
            width: 0%;
            transition: width 0.5s ease;
        }

        @keyframes progressGlow {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        .status-messages {
            font-size: 1.2rem;
            color: #00d4ff;
            margin-bottom: 20px;
            min-height: 30px;
            text-shadow: 0 0 10px #00d4ff;
        }

        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }

        .info-box {
            background: rgba(0, 255, 65, 0.1);
            border: 2px solid #00ff41;
            border-radius: 10px;
            padding: 20px 40px;
            margin-top: 40px;
            max-width: 600px;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.3);
        }

        .info-box p {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #fff;
        }

        .eta {
            font-size: 1.3rem;
            color: #ff6b00;
            font-weight: bold;
            margin-top: 10px;
            text-shadow: 0 0 10px #ff6b00;
        }

        .scanline {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                transparent 50%,
                rgba(0, 255, 65, 0.03) 50%
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 999;
            animation: scanlines 8s linear infinite;
        }

        @keyframes scanlines {
            0% { transform: translateY(0); }
            100% { transform: translateY(4px); }
        }

        /* Responsive design */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
            .subtitle {
                font-size: 1.2rem;
            }
            .logo {
                width: 150px;
                height: 150px;
            }
            .info-box {
                padding: 15px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Starfield background -->
    <div class="stars" id="starfield"></div>

    <!-- Scanline effect -->
    <div class="scanline"></div>

    <!-- Main content -->
    <div class="container">
        <img src="barodatek-logo.png" alt="BarodaTek Llama Logo" class="logo">
        
        <h1>üéÆ SYSTEM UPDATE</h1>
        <p class="subtitle">BarodaTek Arena Maintenance Mode</p>

        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <p class="status-messages">
            <span id="statusText" class="loading-dots">Deploying new features</span>
        </p>

        <div class="info-box">
            <p>
                üîß We're currently updating the BarodaTek Arena with new features and improvements.
                <br>
                üöÄ The system will be back online shortly.
                <br>
                üíæ All your data and progress is safe.
            </p>
            <p class="eta">
                ‚è±Ô∏è Estimated time: <span id="eta">2-3 minutes</span>
            </p>
        </div>
    </div>

    <script>
        // Create animated starfield
        const starfield = document.getElementById('starfield');
        for (let i = 0; i < 200; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.animationDelay = Math.random() * 3 + 's';
            starfield.appendChild(star);
        }

        // Animated progress bar
        const progressBar = document.getElementById('progressBar');
        const statusText = document.getElementById('statusText');
        const eta = document.getElementById('eta');

        const statuses = [
            'Initializing deployment',
            'Updating server components',
            'Deploying new features',
            'Optimizing performance',
            'Running final checks',
            'Almost ready'
        ];

        let progress = 0;
        let statusIndex = 0;

        // Simulate progress
        const progressInterval = setInterval(() => {
            progress += Math.random() * 15;
            if (progress >= 100) {
                progress = 100;
                clearInterval(progressInterval);
                statusText.textContent = '‚úÖ Update complete! Redirecting...';
                statusText.classList.remove('loading-dots');
                
                // Auto-refresh after completion (in case maintenance mode wasn't disabled)
                setTimeout(() => {
                    window.location.reload();
                }, 3000);
            } else {
                // Update status message
                const newStatusIndex = Math.floor((progress / 100) * statuses.length);
                if (newStatusIndex !== statusIndex && newStatusIndex < statuses.length) {
                    statusIndex = newStatusIndex;
                    statusText.textContent = statuses[statusIndex];
                }
                
                // Update ETA
                const remainingMinutes = Math.ceil((100 - progress) / 20);
                eta.textContent = remainingMinutes > 0 ? `${remainingMinutes} minute${remainingMinutes > 1 ? 's' : ''}` : 'Less than a minute';
            }
            
            progressBar.style.width = progress + '%';
        }, 2000);

        // Enhanced auto-detection: Check if maintenance.flag exists
        const checkInterval = setInterval(async () => {
            try {
                // Primary check: Look for maintenance.flag file
                const flagResponse = await fetch('/maintenance.flag', { 
                    method: 'HEAD',
                    cache: 'no-cache'
                });
                
                // If flag doesn't exist (404), maintenance is over
                if (flagResponse.status === 404) {
                    console.log('‚úÖ Maintenance flag removed - redirecting to updated site...');
                    clearInterval(checkInterval);
                    
                    // Smooth transition
                    document.querySelector('.container').style.opacity = '0';
                    setTimeout(() => {
                        window.location.href = '/?cache=' + Date.now();
                    }, 500);
                    return;
                }
                
                // Secondary check: Try to fetch the main site
                const response = await fetch('/', { 
                    method: 'HEAD',
                    cache: 'no-cache'
                });
                
                if (response.ok) {
                    // Check if we're still on maintenance page
                    const currentPath = window.location.pathname;
                    if (currentPath.includes('maintenance')) {
                        // Site is back online, redirect
                        console.log('‚úÖ Site back online - redirecting...');
                        clearInterval(checkInterval);
                        window.location.href = '/?cache=' + Date.now();
                    }
                }
            } catch (error) {
                // Still in maintenance mode - this is normal
                console.log('‚è≥ Maintenance active, checking again in 5 seconds...');
            }
        }, 5000);  // Check every 5 seconds
        
        // Log startup
        console.log('üéÆ BarodaTek Arena Maintenance Mode Active');
        console.log('‚è≥ Checking for site updates every 5 seconds...');
        console.log('üí° Maintenance will auto-disappear when deployment complete');
    </script>
</body>
</html>
